extends layout

block header
	script(src='/js/validator.min.js')
	script(src='/js/jquery.form.min.js')

	link(rel='stylesheet', href='/css/card-style.css')


block content
	.col-md-12.page-header
		h2.text-info
			b Homework List

	if admin
		.col-xs-12
			a.pull-right(role='button', href='/homework/add')
				h4#btn-add
					| #[span.glyphicon.glyphicon-plus]
					| Add

	each homework in homeworkList
		.col-xs-12.col-md-6.homework-card
			.panel.panel-default
				.panel-body
					.col-xs-12
						h2.wrapped-text.card-header
							b=homework.name

						.row
							.col-xs-12.col-sm-4.col-md-12
								h4
									b Description
								p
									a.wrapped-text(target='_blank', href=homework.description)=homework.description

							.col-xs-6.col-sm-4
								h4
									b Start Date
								p=homework.startDate

							.col-xs-6.col-sm-4
								h4
									b Deadline
								p=homework.dueDate

					.col-xs-12
						h4
							a.pull-right.appender(role='button', data-toggle='collapse', href='#collapseExample' + homework.id, aria-expanded='false', aria-controls='collapseExample' + homework.id)
								| #[i.fa.fa-upload(aria-hidden="true")]
								| Submit
								| #[span.glyphicon.glyphicon-menu-down]

				- const present = Date.now();

				ul.list-group.collapse(id='collapseExample' + homework.id)
					each attachment in homework.attachments
						form.upload-form(action='/homework/' + attachment.id, method='POST', encType="multipart/form-data", role='form', data-toggle="validator", data-focus='false')
							li.list-group-item(class=attachment.latestFile == null ? '' : 'list-group-item-success')
								.row
									.col-xs-12.col-sm-5.vcenter
										h4.wrapped-text
											| #[span.glyphicon.glyphicon-file]
											| &nbsp;
											| #{attachment.name}

									if signIn && homework.deadline > present
										.col-xs-12.col-sm-7.vcenter
											.form-group
												.pull-right.input-group
													input.form-control(type='text', data-validate='false', readonly)
													.input-group-btn
														span.btn.btn-default.btn-file
															| Select
															input(type='file' name='attachment', hidden, required)
														button.btn.btn-primary(type='submit', role='submit', data-loading-text='<i class="fa fa-refresh fa-spin fa-fw" aria-hidden="true"></i> Sending...') Submit


				.panel-footer.text-center
					- var millis = 24 * 60 * 60 * 1000
					if homework.leftMillis < 0
						| Overpast
					else if homework.leftMillis < millis
						| Less than 24 hours
					else if homework.leftMillis < 2 * millis
						| 1 day left
					else
						| #{Math.floor(homework.leftMillis / millis)} days left

	// confirm modal
	#confirmModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='confirmModalLabel')
		.modal-dialog.modal-lg(role='document')
			.modal-content
				.modal-header
					button.close(type='button', data-dismiss='modal', aria-label='Close')
						span(aria-hidden='true') Ã—
					h2#confirmModalLabel.modal-title.text-warning
				.modal-body
					h4#confirmBody
				.modal-footer
					button.btn.btn-default(type='button', data-dismiss='modal')
						| #[i.fa.fa-times(aria-hidden='true')]
						| Close
					button#confirmOK.btn.btn-primary(type='button')
						| #[i.fa.fa-check(aria-hidden='true')]
						| Submit

	script(src='/js/card-run.js')
	script(src='/js/attachment_uploader.js')